var currentPhase, nextPhase, previousPhase;
var left, opacity, scale;
var isAnimating; 

/**
 * Handle the next movement between phases
 */
$(".next").click(function()  {


	
	currentPhase = $(this).parent();
	nextPhase = $(this).parent().next();

  if(checkNextPhase(nextPhase.attr('id')))
  {
    
    if(isAnimating) return false;
	  isAnimating = true;
//show the next fieldset
	nextPhase.show(); 
	//hide the current fieldset with style
	currentPhase.animate({opacity: 0}, {
		step: (now, mx) => {
			//as the opacity of currentPhase reduces to 0 - stored in "now"
			//1. scale currentPhase down to 80%
			scale = 1 - (1 - now) * 0.2;
			//2. bring nextPhase from the right(50%)
			left = (now * 50)+"%";
			//3. increase opacity of nextPhase to 1 as it moves in
			opacity = 1 - now;
			currentPhase.css({
        'transform': 'scale('+scale+')',
        'position': 'absolute'
      });
			nextPhase.css({'left': left, 'opacity': opacity});
		}, 
		duration: 800, 
		complete: function() {
			currentPhase.hide();
			isAnimating = false;
		}, 
		//this comes from the custom easing plugin
		easing: 'easeInOutBack'
	});
  }
});

/**
 * Handle the back movement between phases
 */
$(".previous").click(function()  {
	if(isAnimating) return false;
	isAnimating = true;
	
	currentPhase = $(this).parent();
	previousPhase = $(this).parent().prev();
	
	//show the previous fieldset
	previousPhase.show(); 
	//hide the current fieldset with style
	currentPhase.animate({opacity: 0}, {
		step: (now, mx) => {
			//as the opacity of currentPhase reduces to 0 - stored in "now"
			//1. scale previousPhase from 80% to 100%
			scale = 0.8 + (1 - now) * 0.2;
			//2. take currentPhase to the right(50%) - from 0%
			left = ((1-now) * 50)+"%";
			//3. increase opacity of previousPhase to 1 as it moves in
			opacity = 1 - now;
			currentPhase.css({'left': left});
			previousPhase.css({'transform': 'scale('+scale+')', 'opacity': opacity});
		}, 
		duration: 800, 
		complete: function()  {
			currentPhase.hide();
			isAnimating = false;
		}, 
		//this comes from the custom easing plugin
		easing: 'easeInOutBack'
	});
});

/**
 * Verifies if this is the last phase, so it can change the labels of options
 */
function checkNextPhase(nextPhaseId)
{
  
    if(nextPhaseId == "phase1")
    {
      let user = document.getElementById('user').value;      
      let myPassword = document.getElementById('myPassword').value;
      let confirm_password = document.getElementById ('confirm_password').value;
      
      if((user == '') || (myPassword == '') || (confirm_password == ''))
      {
         swal(
          'Atenção',
          'O campo nome de usuario e senhas devem ser preenchidos',
          'warning'
          )
        
          return false;
      }

    }

    if(nextPhaseId === "phase2")
    {
      let email = document.getElementById('email').value;      
      let phone = document.getElementById('phone').value;
      
      if((email == '') || (phone == ''))
      {
         swal(
          'Atenção',
          'O campo email e telefones devem ser preenchidos',
          'warning'
          )
        
          return false;
      
        }
    }

    if(nextPhaseId === "phase3")
    {
      let nome = document.getElementById('nome').value;      
      let sobrenome = document.getElementById('sobrenome').value;
      let idade = document.getElementById ('idade').value;
      let cpf = document.getElementById ('cpf').value;
      let cep = document.getElementById ('cep').value;
      let rua = document.getElementById ('rua').value;
      let numero = document.getElementById ('numero').value;
      let bairro = document.getElementById ('bairro').value;
      let cidade = document.getElementById ('cidade').value;
      let uf = document.getElementById ('uf').value
      
      if((nome == '') || (sobrenome== '') || (idade== '') || (cpf == '') || (cep == '') || (rua == '') || (numero == '') || (bairro == '') || (cidade == '') || (uf == ''))
      {
         swal(
          'Atenção',
          'todos os campos devem ser preenchidos',
          'warning'
          )
        
          return false;
      
        }
    }

  
}

/**
 * Handle the submit button click, preventing from a form submit
 */
$(".submit").click(function()  {

    let dataObj = {
        'user': '',
        'myPassword': '',
        'confirm_password': '',
        'email': '',
        'phone': '',
        'nome': '',
        'sobrenome': '',
        'idade': '',
        'cpf':'',
        'cep':'',
        'rua':'',
        'numero':'',
        'bairro':'',
        'cidade':'',
        'uf':''
    }

    retrieveDataFromFields(dataObj);
    sendData(dataObj);

    return false;
});

/**
 * Checks the area selected acessing the element
 */

function retrieveDataFromFields(dataObj)
{
    dataObj.user = document.getElementById('user').value;
    dataObj.myPassword = document.getElementById('myPassword').value;
    dataObj.confirm_password = document.getElementById('confirm_password').value;
    dataObj.email = document.getElementById('email').value;
    dataObj.phone = document.getElementById('phone').value;
    dataObj.nome = document.getElementById('nome').value;
    dataObj.sobrenome = document.getElementById('sobrenome').value;
    dataObj.idade = document.getElementById('idade').value;
    dataObj.cpf = document.getElementById('cpf').value;
    dataObj.cep = document.getElementById('cep').value;
    dataObj.rua = document.getElementById('rua').value;
    dataObj.numero = document.getElementById('numero').value;
    dataObj.bairro = document.getElementById('bairro').value;
    dataObj.cidade = document.getElementById('cidade').value;
    dataObj.uf = document.getElementById('uf').value;
    

    ;
}

/**
 * Sends the data collected at the quiz
 */
function sendData(dataObj)
{
    console.dir(dataObj);

    $.ajax({
        type: "POST",
        url: '/quiz',
        data: dataObj,
        success: (data) =>{
            console.log('Data sent! :P'); //Will never happen
        },
        error: (data) => {
            swal(
                'Oops...',
                'Nada foi enviado, mas aqui estão os dados:  ' + JSON.stringify(dataObj),
                'error'
            )
        }
    });    
}